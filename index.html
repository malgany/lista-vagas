<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Vagas</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #121933;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #6ee7b7;
      --accent-2: #60a5fa;
      --danger: #f87171;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, #0b1020 0%, #0a0f1c 100%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      max-width: 1100px;
      margin: 24px auto 120px;
      padding: 0 16px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 16px;
    }

    h1 {
      margin: 0;
      font-size: clamp(22px, 3vw, 32px);
      letter-spacing: .4px;
    }

    .toolbar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    /* Alinhamento ajustado: inputs alinhados ao baseline do botão */
    .form {
      display: grid;
      grid-template-columns: 1.2fr 1.5fr 1fr auto;
      gap: 14px;
      padding: 18px;
      align-items: end;
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(6px);
    }

    .form > div { display: flex; flex-direction: column; justify-content: flex-end; }

    label { font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input[type="text"], input[type="url"], input[type="date"], textarea {
      width: 100%;
      background: #0f1530;
      color: var(--text);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
      transition: border-color .15s ease, box-shadow .15s ease;
      height: 42px;
      box-sizing: border-box;
    }
    input:focus, textarea:focus { border-color: var(--accent-2); box-shadow: 0 0 0 4px rgba(96,165,250,.15); }

    button {
      height: 42px;
      border: none;
      padding: 0 16px;
      font-weight: 600;
      border-radius: 10px;
      color: #0b1020;
      background: linear-gradient(180deg, var(--accent-2), #3b82f6);
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: transform .06s ease, filter .2s ease;
      white-space: nowrap;
    }
    button:hover { filter: brightness(1.05); }
    button:active { transform: translateY(1px); }
    .btn-secondary { background: linear-gradient(180deg, #a5b4fc, #818cf8); }
    .btn-danger { background: linear-gradient(180deg, #fda4af, #f87171); }
    .btn-ghost { background: transparent; color: var(--text); border: 1px solid rgba(255,255,255,.18); }

    .table-wrapper { margin-top: 28px; padding: 12px 14px; }

    table { width: 100%; border-collapse: collapse; }
    thead th {
      text-align: left;
      font-size: 12px;
      letter-spacing: .5px;
      color: var(--muted);
      padding: 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      user-select: none;
      cursor: pointer;
      position: relative;
    }
    tbody td { padding: 12px 10px; border-bottom: 1px solid rgba(255,255,255,.08); }
    tbody tr:hover { background: rgba(255,255,255,.03); }

    .sort-indicator { position: absolute; right: 8px; opacity: .7; }

    .link {
      color: #c7d2fe; text-decoration: none; border-bottom: 1px dashed rgba(199,210,254,.5);
    }
    .link:hover { text-decoration: underline; }

    /* Modal */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,.55);
      display: none; align-items: center; justify-content: center; z-index: 50;
      padding: 16px;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      width: min(820px, 96vw);
      background: #0f1530;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .modal header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 12px; }
    .modal h3 { margin: 0; font-size: 18px; }
    .modal .actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .modal textarea { width: 100%; min-height: 260px; }

    /* Toast */
    .toast-area { position: fixed; bottom: 18px; right: 18px; display: grid; gap: 8px; z-index: 60; }
    .toast {
      background: #0f1530; border: 1px solid rgba(255,255,255,.16); color: var(--text);
      border-left: 6px solid var(--accent);
      padding: 10px 12px; border-radius: 10px; box-shadow: var(--shadow);
      animation: slideIn .22s ease;
    }
    .toast.error { border-left-color: var(--danger); }
    @keyframes slideIn { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    @media (max-width: 820px) {
      .form { grid-template-columns: 1fr; position: static; }
      button { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Controle de Vagas</h1>
      <div class="toolbar">
        <button id="btnExport" class="btn-secondary" title="Exportar JSON">Exportar</button>
        <button id="btnImport" class="btn-ghost" title="Importar JSON">Importar</button>
      </div>
    </div>

    <!-- Formulário no topo -->
    <form id="vagaForm" class="card form" autocomplete="off">
      <div>
        <label for="empresa">Nome da empresa</label>
        <input id="empresa" name="empresa" type="text" placeholder="Ex.: Acme Ltda" required />
      </div>
      <div>
        <label for="link">Link da vaga</label>
        <input id="link" name="link" type="url" placeholder="https://exemplo.com/vaga" required />
      </div>
      <div>
        <label for="data">Data de submissão</label>
        <input id="data" name="data" type="date" required />
      </div>
      <div>
        <button id="btnIncluir" type="submit">Incluir</button>
      </div>
    </form>

    <!-- Tabela na parte de baixo -->
    <div class="card table-wrapper">
      <table id="tabela">
        <thead>
          <tr>
            <th data-col="empresa">EMPRESA <span class="sort-indicator" aria-hidden>▾</span></th>
            <th data-col="link">LINK</th>
            <th data-col="data">DATA</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- Modal Exportar -->
  <div id="exportOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="exportTitle">
    <div class="modal">
      <header>
        <h3 id="exportTitle">Exportar dados (JSON)</h3>
        <div class="actions">
          <button id="btnCopy" class="btn-secondary" type="button">Copiar</button>
          <button id="btnDownload" type="button">Baixar JSON</button>
          <button id="btnCloseExport" class="btn-ghost" type="button">Fechar</button>
        </div>
      </header>
      <textarea id="exportText" readonly spellcheck="false"></textarea>
    </div>
  </div>

  <!-- Modal Importar -->
  <div id="importOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="importTitle">
    <div class="modal">
      <header>
        <h3 id="importTitle">Importar dados (JSON)</h3>
        <div class="actions">
          <button id="btnLoad" class="btn-secondary" type="button">Carregar</button>
          <button id="btnCloseImport" class="btn-ghost" type="button">Cancelar</button>
        </div>
      </header>
      <textarea id="importText" placeholder='Cole aqui um array de objetos no formato [{"empresa":"...","link":"...","data":"YYYY-MM-DD"}, ...]'></textarea>
    </div>
  </div>

  <div class="toast-area" id="toasts" aria-live="polite" aria-atomic="true"></div>

  <script>
    (function() {
      const STORAGE_KEY = 'vagasDataV1';
      /** @type {{empresa:string, link:string, data:string}[]} */
      let vagas = [];
      let sortState = { col: 'empresa', dir: 'asc' };

      const form = document.getElementById('vagaForm');
      const empresaEl = document.getElementById('empresa');
      const linkEl = document.getElementById('link');
      const dataEl = document.getElementById('data');
      const tbody = document.getElementById('tbody');
      const thead = document.querySelector('#tabela thead');

      const exportOverlay = document.getElementById('exportOverlay');
      const exportText = document.getElementById('exportText');
      const btnExport = document.getElementById('btnExport');
      const btnCopy = document.getElementById('btnCopy');
      const btnDownload = document.getElementById('btnDownload');
      const btnCloseExport = document.getElementById('btnCloseExport');

      const importOverlay = document.getElementById('importOverlay');
      const importText = document.getElementById('importText');
      const btnImport = document.getElementById('btnImport');
      const btnLoad = document.getElementById('btnLoad');
      const btnCloseImport = document.getElementById('btnCloseImport');

      function showToast(msg, type = 'ok') {
        const area = document.getElementById('toasts');
        const t = document.createElement('div');
        t.className = 'toast' + (type === 'error' ? ' error' : '');
        t.textContent = msg;
        area.appendChild(t);
        setTimeout(() => t.remove(), 3600);
      }

      function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(vagas));
      }

      function load() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          vagas = raw ? JSON.parse(raw) : [];
          // normalizar datas para YYYY-MM-DD
          for (const v of vagas) {
            if (v.data && v.data.includes('/')) v.data = toISODate(v.data);
          }
        } catch (e) {
          console.error(e);
          vagas = [];
        }
      }

      function sanitize(str) { return (str || '').toString().trim(); }

      function isValidUrl(u) {
        try { new URL(u); return true; } catch { return false; }
      }

      function toDisplayDate(iso) {
        if (!iso) return '';
        // expect YYYY-MM-DD
        const [y,m,d] = iso.split('-');
        if (!y || !m || !d) return iso;
        return `${d.padStart(2,'0')}/${m.padStart(2,'0')}/${y}`;
      }

      function toISODate(val) {
        // Accepts 'YYYY-MM-DD' or 'DD/MM/YYYY'
        if (!val) return '';
        if (val.includes('/')) {
          const [d, m, y] = val.split('/');
          return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
        }
        return val; // assume already ISO
      }

      function addOrUpdate(entry) {
        const idx = vagas.findIndex(v => v.link === entry.link);
        if (idx >= 0) {
          vagas[idx] = entry; // substituir
          return 'replaced';
        } else {
          vagas.push(entry);
          return 'added';
        }
      }

      function renderTable() {
        // ordenar conforme estado
        const sorted = [...vagas].sort((a,b) => {
          const col = sortState.col;
          let av = a[col] || '', bv = b[col] || '';
          if (col === 'data') { // comparar por data ISO
            av = a.data || '';
            bv = b.data || '';
          } else {
            av = av.toString().toLowerCase();
            bv = bv.toString().toLowerCase();
          }
          if (av < bv) return sortState.dir === 'asc' ? -1 : 1;
          if (av > bv) return sortState.dir === 'asc' ? 1 : -1;
          return 0;
        });

        tbody.innerHTML = '';
        for (const v of sorted) {
          const tr = document.createElement('tr');
          const tdEmpresa = document.createElement('td');
          tdEmpresa.textContent = v.empresa;

          const tdLink = document.createElement('td');
          const a = document.createElement('a');
          a.href = v.link; a.target = '_blank'; a.rel = 'noopener noreferrer';
          a.textContent = v.link; a.className = 'link';
          tdLink.appendChild(a);

          const tdData = document.createElement('td');
          tdData.textContent = toDisplayDate(v.data);

          tr.appendChild(tdEmpresa);
          tr.appendChild(tdLink);
          tr.appendChild(tdData);
          tbody.appendChild(tr);
        }

        // atualizar indicadores visuais de ordenação
        document.querySelectorAll('thead th').forEach(th => {
          const ind = th.querySelector('.sort-indicator') || document.createElement('span');
          ind.className = 'sort-indicator';
          if (th.dataset.col === sortState.col) {
            ind.textContent = sortState.dir === 'asc' ? '▴' : '▾';
          } else {
            ind.textContent = '';
          }
          if (!th.querySelector('.sort-indicator')) th.appendChild(ind);
        });
      }

      function openExport() {
        exportText.value = JSON.stringify(vagas, null, 2);
        exportOverlay.classList.add('open');
        exportText.focus();
        exportText.select();
      }

      function copyExport() {
        const txt = exportText.value;
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(txt).then(() => showToast('JSON copiado!')).catch(() => fallbackCopy());
        } else {
          fallbackCopy();
        }
        function fallbackCopy() {
          exportText.focus();
          exportText.select();
          const ok = document.execCommand('copy');
          showToast(ok ? 'JSON copiado!' : 'Não foi possível copiar', ok ? 'ok' : 'error');
        }
      }

      function downloadExport() {
        try {
          const blob = new Blob([exportText.value], { type: 'application/json;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = 'vagas.json';
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
          showToast('Download iniciado');
        } catch (e) {
          console.error(e);
          showToast('Falha ao iniciar download', 'error');
        }
      }

      function openImport() {
        importText.value = '';
        importOverlay.classList.add('open');
        importText.focus();
      }

      function doImport() {
        let data;
        try {
          data = JSON.parse(importText.value);
        } catch (e) {
          showToast('JSON inválido', 'error');
          return;
        }
        if (!Array.isArray(data)) {
          showToast('Esperado um array de objetos', 'error');
          return;
        }
        let added = 0, replaced = 0, skipped = 0;
        for (const raw of data) {
          if (!raw || typeof raw !== 'object') { skipped++; continue; }
          const empresa = sanitize(raw.empresa);
          const link = sanitize(raw.link);
          let dt = sanitize(raw.data);
          dt = toISODate(dt);
          if (!empresa || !link || !dt || !isValidUrl(link)) { skipped++; continue; }
          const res = addOrUpdate({ empresa, link, data: dt });
          if (res === 'added') added++; else replaced++;
        }
        save();
        renderTable();
        importOverlay.classList.remove('open');
        showToast(`Importação concluída — ${added} adicionada(s), ${replaced} substituída(s), ${skipped} ignorada(s)`);
      }

      // Eventos
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const empresa = sanitize(empresaEl.value);
        const link = sanitize(linkEl.value);
        const data = toISODate(sanitize(dataEl.value));
        if (!empresa) { showToast('Informe o nome da empresa', 'error'); empresaEl.focus(); return; }
        if (!isValidUrl(link)) { showToast('Link inválido', 'error'); linkEl.focus(); return; }
        if (!data) { showToast('Informe a data', 'error'); dataEl.focus(); return; }
        const res = addOrUpdate({ empresa, link, data });
        save();
        renderTable();
        form.reset();
        empresaEl.focus();
        showToast(res === 'added' ? 'Vaga incluída' : 'Vaga atualizada');
      });

      thead.addEventListener('click', (e) => {
        const th = e.target.closest('th');
        if (!th) return;
        const col = th.dataset.col;
        if (!col) return;
        if (sortState.col === col) {
          sortState.dir = sortState.dir === 'asc' ? 'desc' : 'asc';
        } else {
          sortState.col = col; sortState.dir = 'asc';
        }
        renderTable();
      });

      btnExport.addEventListener('click', openExport);
      btnCopy.addEventListener('click', copyExport);
      btnDownload.addEventListener('click', downloadExport);
      btnCloseExport.addEventListener('click', () => exportOverlay.classList.remove('open'));
      exportOverlay.addEventListener('click', (e) => { if (e.target === exportOverlay) exportOverlay.classList.remove('open'); });

      btnImport.addEventListener('click', openImport);
      btnLoad.addEventListener('click', doImport);
      btnCloseImport.addEventListener('click', () => importOverlay.classList.remove('open'));
      importOverlay.addEventListener('click', (e) => { if (e.target === importOverlay) importOverlay.classList.remove('open'); });

      // Inicialização
      load();
      renderTable();

      // Atalhos: ESC fecha modais
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          exportOverlay.classList.remove('open');
          importOverlay.classList.remove('open');
        }
      });
    })();
  </script>
</body>
</html>
